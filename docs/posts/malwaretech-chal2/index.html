<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        MalwareTech Windows Reversing Challenge #2 Write-Ups ::
        Reversing Stories
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="[Hide and Seek]#Strings#Hello friend, back again with the MalwareTech Windows reversing challenge, now we are given a PE file named strings2.exe_.
Same as the previous challenge, we can only use static analysis to solve this challenge.
The description of this challenge:
 strings2.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original."
/>
<meta
  name="keywords"
  content=""
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="/posts/malwaretech-chal2/" />





<link rel="stylesheet" href="/assets/style.css" />

<link rel="stylesheet" href="/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="/img/favicon.png" />


<link href="/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MalwareTech Windows Reversing Challenge #2 Write-Ups"/>
<meta name="twitter:description" content="[Hide and Seek]#Strings#Hello friend, back again with the MalwareTech Windows reversing challenge, now we are given a PE file named strings2.exe_.
Same as the previous challenge, we can only use static analysis to solve this challenge.
The description of this challenge:
 strings2.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original."/>



<meta property="og:title" content="MalwareTech Windows Reversing Challenge #2 Write-Ups" />
<meta property="og:description" content="[Hide and Seek]#Strings#Hello friend, back again with the MalwareTech Windows reversing challenge, now we are given a PE file named strings2.exe_.
Same as the previous challenge, we can only use static analysis to solve this challenge.
The description of this challenge:
 strings2.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original." />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/malwaretech-chal2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-15T00:52:50+07:00" />
<meta property="article:modified_time" content="2022-05-15T00:52:50+07:00" /><meta property="og:site_name" content="Reversing Stories" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Reversing Stories</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
      
      
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">MalwareTech Windows Reversing Challenge #2 Write-Ups</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2022-05-15
        </span>

        
          
        
      

      


      
    </div>

    

    

    <div class="post-content">
      
      <h2 id="hide-and-seek">
  [Hide and Seek]
  <a href="#hide-and-seek" class="h-anchor" aria-hidden="true">#</a>
</h2>
<h3 id="strings">
  Strings
  <a href="#strings" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>Hello friend, back again with the MalwareTech Windows reversing challenge, now we are given a PE file named <em>strings2.exe_</em>.</p>
<p>Same as the <a href="https://irfanalditya.github.io/posts/malwaretech-chal1/">previous challenge</a>, we can only use static analysis to solve this challenge.</p>
<p>The description of this challenge:</p>
<blockquote>
<p>strings2.exe contains an un-encrypted flag stored within the executable. When run, the program will output an MD5 hash of the flag but not the original. Can you extract the flag?</p>
</blockquote>
<p>Let&rsquo;s start it with <em>detect it easy</em>:</p>
<p><img src="Snipaste_2022-05-15_01-45-16.jpg" alt="pic1"></p>
<p>This PE uses C++, so i opened in Ghidra, go to the entry point function.</p>
<p><img src="Snipaste_2022-05-15_01-49-27.jpg" alt="pic2"></p>
<p>If we read the description, we can conclude that the parameter passed to the md5_hash function is the flag. But in this case, instead of storing the flag string in the data section which can be clearly identified by the ghidra decompiler, the program will initialize it in stack memory at runtime, so ghidra will identify it as undefined data instead of a string.</p>
<p>To read out stack string values clearly, we can simply update Ghidra’s stack frame description so that the individual opaque bytes are interpreted as elements in a character array. The easiest way to do this is to retype the earliest element from undefined to char[n] where n is the length of the reconstructed string.</p>
<p><img src="Snipaste_2022-05-15_02-13-32.jpg" alt="pic3"></p>
<p>Then we can see the string, but we have to read it vertically.</p>
<p><img src="Snipaste_2022-05-15_02-23-31.jpg" alt="pic4"></p>
<p>seems like the string is still not comfortable to read, huh?, especially if in the future we have to analyze 1 or 2 or more long stack strings, would definitely be very difficult and ineffective.</p>
<p>So here i&rsquo;m going to write a Ghidra script to print the stack string that i want to analyze automatically.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">from</span> ghidra.program.model.address <span style="color:#f92672">import</span> AddressSet
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>max_addr <span style="color:#f92672">=</span> currentSelection<span style="color:#f92672">.</span>getMaxAddress()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>stack_str <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>inst <span style="color:#f92672">=</span> getInstructionAt(currentSelection<span style="color:#f92672">.</span>getMinAddress())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> inst<span style="color:#f92672">.</span>address <span style="color:#f92672">&lt;</span> max_addr:
</span></span><span style="display:flex;"><span>	stack_str <span style="color:#f92672">+=</span> chr(inst<span style="color:#f92672">.</span>getScalar(<span style="color:#ae81ff">1</span>)<span style="color:#f92672">.</span>value <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">0xff</span>)
</span></span><span style="display:flex;"><span>	inst <span style="color:#f92672">=</span> inst<span style="color:#f92672">.</span>getNext()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print stack_str
</span></span></code></pre></div><p>With this script, i just need to do a selection from the first element to the last element of the stack string and run the script then we can see the result in Ghidra&rsquo;s console.</p>
<p><img src="Snipaste_2022-05-15_02-51-26.jpg" alt="pic6"></p>
<p>Run the script and here is the result:</p>
<p><img src="Snipaste_2022-05-15_02-55-57.jpg" alt="pic7"></p>
<p>Let&rsquo;s check this flag <em>FLAG{STACK-STRINGS-ARE-BEST-STRINGS}</em> :</p>
<p><img src="Snipaste_2022-05-15_02-59-16.jpg" alt="pic8"></p>
<p>Ok, we&rsquo;ve got the flag.</p>
<p>Challenge source: <a href="https://www.malwaretech.com/challenges/windows-reversing/strings2">https://www.malwaretech.com/challenges/windows-reversing/strings2</a></p>

    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="/posts/malwaretech-chal3/">
                  <span class="button__icon">←</span>
                  <span class="button__text">MalwareTech Windows Reversing Challenge #3 Write-Ups</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="/posts/malwaretech-chal1/">
                  <span class="button__text">MalwareTech Windows Reversing Challenge #1 Write-Ups</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >Reversing Stories</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span
          >© 2022 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
        <span
          >Theme created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span
        >
      </div>
    
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
